<script type="text/javascript">
    $(function(ready){
        $("#merge").on("change","select",function () {
            $.ajax({
                url: "/warehouse/stockmergement/loadunit/id/" + document.getElementsByName("stock[stockmergement_id]")[0].value,
                type: "POST",
                success: function(data){
                    $("#unitfromlabel").html(data.unit);
                },
                error : function(xhr, textStatus, errorThrown) {
                    $("#unitfromlabel").html("error when loading unit");
                }
            });
        });

        $("#chkautobarcode").change(function() {
            event.preventDefault();
            if ($(this).is(":checked")){
                $.ajax({
                    url: "/warehouse/tools/generatebarcode",
                    type: "POST",
                    success: function(data){
                        $("#barcode").val(data.barcode);
                    },
                    error : function(xhr, textStatus, errorThrown) {
                        $("#barcode").val("error when loading autogenerated barcode");
                    }
                });
            } else {
                $("#barcode").val("");
            }
        });
    });
</script>

<h1>Update Article</h1>
<?php
$myStock = $this->stock;
$form = $this->form;
$form->prepare();
?>
<?=$this->form()->openTag($form);?>

<table width="100%">
    <tr>
        <td width="15%">Barcode:</td>
        <td>
            <?=$this->formInput($this->form->get('stock')->get('barcode'));?>
            <?=$this->fieldRow($this->form->get('stock')->get('chkautobarcode')) . ' auto generate';?>
        </td>
    </tr>
    <tr>
        <td width="15%"></td>
        <td><?=$this->formElementErrors($form->get('stock')->get('barcode'), ['class' => 'custom_form_errors']);?></td>
    </tr>
    <tr>
        <td width="15%">Description:</td>
        <td><?=$this->formTextarea($this->form->get('stock')->get('description'));?></td>
    </tr>
    <tr>
        <td width="15%"></td>
        <td><?=$this->formElementErrors($form->get('stock')->get('description'), ['class' => 'custom_form_errors']);?></td>
    </tr>
    <tr>
        <td width="15%">Short description:</td>
        <td>
            <div id="merge">
                <?=$this->formSelect($this->form->get('stock')->get('stockmergement_id'));?>
                <?=$this->fieldRow($this->form->get('stock')->get('prefered')). ' prefered';?>
            </div>
        </td>
    </tr>
    <tr>
        <td width="15%"></td>
        <td><?=$this->formElementErrors($form->get('stock')->get('stockmergement_id'), ['class' => 'custom_form_errors']);?></td>
    </tr>
    <tr>
        <td width="15%">Supplier reference:</td>
        <td><?=$this->formInput($this->form->get('stock')->get('supplierreference'));?></td>
    </tr>
    <tr>
        <td width="15%">Notes:</td>
        <td><?=$this->formTextarea($this->form->get('stock')->get('notes'));?></td>
    </tr>
</table>

<hr>

<table width="100%">
    <tr>
        <td width="15%">Quantity:</td>
        <td><?=$this->formInput($this->form->get('stock')->get('quantity'));?></td>
    </tr>
    <tr>
        <td width="15%">Info threshold:</td>
        <td><?=$this->formInput($this->form->get('stock')->get('infothreshold'));?></td>
    </tr>
    <tr>
        <td width="15%">Critical threshold:</td>
        <td><?=$this->formInput($this->form->get('stock')->get('criticalthreshold'));?></td>
    </tr>
</table>

<hr>

<table width="100%">
    <tr>
        <td width="15%">Net quantity:</td>
        <td>
            <?=$this->formRow($this->form->get('stock')->get('netquantity'));?>
            <span id="unitfromlabel">
                <?php if ($myStock->getStockMergement() != null): ?>
                    <?=$myStock->getStockMergement()->getMeasureUnit()->getUnit();?>
                <?php endif; ?>
            </span>
        </td>
    </tr>
    <tr>
        <td width="15%">Status:</td>
        <td><?=$this->formSelect($this->form->get('stock')->get('status'));?></td>
    </tr>
</table>

<hr>

<?=$this->formInput($form->get('backToList'));?>&nbsp;
<?=$this->formInput($form->get('update'));?>&nbsp;
<?=$this->formInput($form->get('cancel'));?>
<?=$this->form()->closeTag();?>

<br />
